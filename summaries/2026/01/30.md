# Activity Summary for 1/30/2026

## 11:04:24 AM
The log details changes across two PHP files: `app/Models/PlotBox/Contact.php` and `app/SMCore/Services/PlotBox/PlotBoxHubSpotService.php`, all occurring on January 21-22, 2026.

### File-Specific Updates:

#### `c:\Users\efeno\dev\datalink\app\Models\PlotBox\Contact.php`

This file, a Laravel Eloquent model for `Contact` within the `PlotBox` namespace, undergoes frequent modifications. The primary area of change is within the `getDataWithDateRange` static method, which executes a complex SQL query against a Snowflake data warehouse (`PLOTBOX_WAREHOUSE.WAREHOUSE_EVERSTORYPARTNERS`).

**Timestamp: 1/21/2026, 12:51:05 PM**
*   Initial state of the `getDataWithDateRange` method. The `WHERE` clause in the `base_contracts` CTE filters records based on `LAST_UPDATED_DATE_TIME_UTC` or `LAST_UPDATED_DATETIME` within a specified date range. A `contractStatusFilter` is applied in production environments.
*   The `contract_tax_totals` CTE includes a `cancelled_contract_fee_tax` in its sum.

**Timestamp: 1/21/2026, 12:52:00 PM**
*   A significant change is introduced in the `base_contracts` CTE's `WHERE` clause. The original date range filtering logic is commented out, and a hardcoded filter `DIM_CONTRACT.CONTRACT_NUMBER = '645-110814'` is added. This suggests a temporary change, likely for testing or debugging a specific contract.
*   The output `SELECT` statement remains truncated at the end.

**Timestamp: 1/21/2026, 12:54:01 PM**
*   No functional change detected in the provided snippet compared to the previous timestamp. The hardcoded contract number and commented-out date filters persist.
*   The output `SELECT` statement continues to be truncated.

**Timestamp: 1/21/2026, 1:37:28 PM**
*   No functional change detected. The code remains identical to the 12:52 PM and 12:54 PM versions, retaining the hardcoded contract number and truncated `SELECT` output.

**Timestamp: 1/21/2026, 3:57:10 PM**
*   The `cancelled_contract_fee_tax` CTE is completely commented out.
*   Consequently, the `contract_tax_totals` CTE is modified to no longer include `COALESCE(ccft.cancelled_fee_tax_total, 0)` in its sum. This indicates a decision to exclude cancelled contract fee tax from the total tax calculation.
*   The hardcoded `DIM_CONTRACT.CONTRACT_NUMBER = '645-110814'` and truncated `SELECT` statement still exist.

**Timestamp: 1/21/2026, 4:05:53 PM**
*   A change is observed in the `contract_fee_tax` CTE: `SUM(f.TAX_AMOUNT * cf.QUANTITY)` is changed to `SUM(cf.TAX_AMOUNT * cf.QUANTITY)`. It appears `f.TAX_AMOUNT` was incorrectly used as `cf.TAX_AMOUNT` in the initial sum.
*   Similarly, in the `deed_fee_tax` CTE: `SUM(f.TAX_AMOUNT * df.QUANTITY)` is changed to `SUM(cf.TAX_AMOUNT * df.QUANTITY)`. This also seems like a correction of a variable name (`cf.TAX_AMOUNT` likely should be `df.TAX_AMOUNT` or `f.TAX_AMOUNT` from the joined `f` table). Given the `FROM WAREHOUSE_EVERSTORYPARTNERS.DIM_DEED_FEE df INNER JOIN WAREHOUSE_EVERSTORYPARTNERS.DIM_FEE f`, `f.TAX_AMOUNT` would be the correct one, making `cf.TAX_AMOUNT` in the snippet appear to be a copy-paste error.
*   The `cancelled_contract_fee_tax` CTE and its reference in `contract_tax_totals` remain commented out.
*   The hardcoded contract number filter and truncated `SELECT` statement persist.

**Timestamp: 1/21/2026, 4:16:07 PM**
*   Correction in `contract_fee_tax` CTE: `SUM(cf.TAX_AMOUNT * cf.QUANTITY)` is corrected back to `SUM(f.TAX_AMOUNT * cf.QUANTITY)`.
*   Correction in `deed_fee_tax` CTE: `SUM(cf.TAX_AMOUNT * df.QUANTITY)` is corrected back to `SUM(df.TAX_AMOUNT * df.QUANTITY)`. This change also includes a potential typo fix, as `df.TAX_AMOUNT` seems to be used directly from `DIM_DEED_FEE` table which is aliased `df` in this context. The prior change to `cf.TAX_AMOUNT` seems incorrect.
*   The `LOWER(f.FEE_TYPE) != 'interest'` is changed to `LOWER(f.FEE_TYPE) != 'Interest'`.
*   The `cancelled_contract_fee_tax` CTE and its reference remain commented out.
*   Hardcoded contract number filter and truncated `SELECT` statement persist.

**Timestamp: 1/21/2026, 4:20:08 PM**
*   Type casting is introduced: `WHERE cf.CONTRACT_ID IN (SELECT CONTRACT_ID FROM base_contracts)` becomes `WHERE cf.CONTRACT_ID IN (CAST(SELECT CONTRACT_ID FROM base_contracts AS INT))`. This is applied to `contract_fee_tax`, `deed_fee_tax`, and the commented-out `cancelled_contract_fee_tax` CTE.
*   The hardcoded `DIM_CONTRACT.CONTRACT_NUMBER` is still present.
*   The output `SELECT` statement is still truncated.

**Timestamp: 1/21/2026, 4:20:13 PM**
*   The hardcoded contract number is changed from `'645-110814'` to `'110814'` in the `base_contracts` CTE's `WHERE` clause.
*   The type casting change from the previous timestamp (`CAST(... AS INT)`) is retained.

**Timestamp: 1/21/2026, 4:20:28 PM**
*   No functional change detected compared to the 4:20:13 PM version. The hardcoded contract number `'110814'` and the `CAST(... AS INT)` remain.

**Timestamp: 1/21/2026, 4:23:56 PM**
*   The `CAST` operation around `SELECT CONTRACT_ID FROM base_contracts` is slightly malformed in `contract_fee_tax` and `deed_fee_tax`, with one parenthesis removed from the inner select. For example, `IN (SELECT CONTRACT_ID FROM base_contracts AS INT)` should likely be `IN (SELECT CAST(CONTRACT_ID AS INT) FROM base_contracts)` or `IN (SELECT CONTRACT_ID FROM base_contracts)` if the column is already INT. The `CAST` itself is outside the subquery's parenthesis.
*   This specific change appears to be a syntax error in the `CAST` statement.

**Timestamp: 1/21/2026, 4:26:14 PM**
*   The `CAST` operation around `SELECT CONTRACT_ID FROM base_contracts` is removed, reverting to the state before 4:20:08 PM for these specific subqueries. So, `WHERE cf.CONTRACT_ID IN (SELECT CONTRACT_ID FROM base_contracts)`. This corrects the syntax error introduced at 4:23:56 PM.
*   The hardcoded contract number `'110814'` and the commented-out `cancelled_contract_fee_tax` persist.

**Timestamp: 1/21/2026, 4:26:47 PM**
*   The `contract_tax_totals` CTE is modified. `COALESCE(ccft.cancelled_fee_tax_total, 0)` is commented out *within* the sum, but the line itself is not. This looks like an incomplete or confused change. The `cancelled_contract_fee_tax` CTE itself remains commented out as before. This effectively leaves `total_tax` as sum of `contract_fee_tax_total` and `deed_fee_tax_total`.
*   Hardcoded contract number still present.

**Timestamp: 1/21/2026, 4:27:14 PM**
*   The `contract_tax_totals` CTE is further modified. `COALESCE(ccft.cancelled_fee_tax_total, 0)` is now fully commented out *and* its preceding `+` operator. The `cancelled_contract_fee_tax` CTE itself remains commented out. This change clarifies the intent from the previous modification: the cancelled fees are definitively excluded from total tax.
*   Hardcoded contract number still present.

**Timestamp: 1/21/2026, 4:27:46 PM**
*   No functional change detected. The code remains identical to the 4:27:14 PM version, confirming the exclusion of cancelled fees from `total_tax`.

**Timestamp: 1/21/2026, 4:31:12 PM**
*   The hardcoded filter `DIM_CONTRACT.CONTRACT_NUMBER = '110814'` in the `base_contracts` CTE's `WHERE` clause is commented out.
*   The original date range filtering logic based on `LAST_UPDATED_DATE_TIME_UTC` and `LAST_UPDATED_DATETIME` for contracts and contract owners is uncommented and re-enabled. This reverts the temporary testing/debugging filter.
*   The `SELECT` statement at the end is finally complete and shows all selected columns. This indicates the query is now fully defined.

**Timestamp: 1/21/2026, 4:32:48 PM**
*   The `SELECT` statement in the final part of the `getDataWithDateRange` method has been completed, resolving the previous truncation. The `FROM` clause for the final `SELECT` is added: `FROM primary_contacts pc LEFT JOIN deceased_contacts dc ON pc.CONTRACT_ID = dc.CONTRACT_ID AND pc.CREATED_BY = dc.CREATED_BY AND dc.rn = 1 LEFT JOIN contract_writers cw ON pc.CONTRACT_ID = cw.CONTRACT_ID AND cw.rn = 1 LEFT`. The final join is `LEFT JOIN item_counts ic`.

**Timestamp: 1/22/2026, 11:24:20 AM**
*   The last `LEFT JOIN` in the final `SELECT` statement is completed to `LEFT JOIN item_counts ic ON pc.CONTRACT_ID = ic.CONTRACT_ID`. This fully resolves the truncated query from previous versions.

**Timestamp: 1/22/2026, 11:24:43 AM**
*   No functional change detected. The code remains identical to the 11:24:20 AM version.

**Timestamp: 1/22/2026, 11:25:33 AM**
*   No functional change detected. The code remains identical to the 11:24:20 AM version.

#### `c:\Users\efeno\dev\datalink\app\SMCore\Services\PlotBox\PlotBoxHubSpotService.php`

This file handles the synchronization of PlotBox data to HubSpot CRM.

**Timestamp: 1/21/2026, 12:54:56 PM**
*   The `syncPlotBoxData` method contains a `dd($dealsBatch);` statement (die and dump) at the end of the `foreach` loop that processes `plotBoxData`. This line would halt execution and dump the contents of `$dealsBatch`, suggesting debugging in progress.
*   The remainder of the `processContacts` method is well-structured with try-catch blocks for resilience in processing different types of contacts and deals, including associations to locations.

**Timestamp: 1/22/2026, 11:19:31 AM**
*   The `dd($dealsBatch);` statement within the `syncPlotBoxData` method is removed. This indicates that the debugging step related to `$dealsBatch` has been completed, allowing the sync process to run fully.

**Timestamp: 1/22/2026, 11:24:34 AM**
*   The `dd($dealsBatch);` statement is reintroduced into the `syncPlotBoxData` method. This suggests further debugging or a regression of the previous change.

**Timestamp: 1/22/2026, 11:25:42 AM**
*   The `dd($dealsBatch);` statement is again removed from the `syncPlotBoxData` method, reverting to the state where the full sync process would execute.

### Patterns and Recurring Elements:

1.  **Debugging via Code Comments and `dd()`:**
    *   In `Contact.php`, the original date range filtering was repeatedly commented out and replaced with a hardcoded `CONTRACT_NUMBER` filter (`'645-110814'` then `'110814'`), suggesting active debugging on a specific contract. This was eventually reverted.
    *   In `PlotBoxHubSpotService.php`, the `dd($dealsBatch);` statement was added and removed multiple times within a short period, strongly indicating an iterative debugging process for deal data.

2.  **SQL Query Refinement:**
    *   The `getDataWithDateRange` method in `Contact.php` is very complex, involving multiple Common Table Expressions (CTEs) and joins to calculate various contract-related metrics (e.g., total tax, item counts, primary/deceased contacts).
    *   There were multiple small corrections and refinements to the SQL query, including:
        *   Fixing variable names in `SUM` calculations (`cf.TAX_AMOUNT` to `f.TAX_AMOUNT`, then `df.TAX_AMOUNT`).
        *   Case sensitivity correction for 'Interest' in `LOWER(f.FEE_TYPE)`.
        *   Attempted `CAST` operations on `CONTRACT_ID` subqueries, which were later reverted due to likely syntax issues or unnecessary complexity.
        *   Comment-out/uncomment activity around `cancelled_contract_fee_tax` calculation in `contract_tax_totals`, suggesting a review or change in how cancelled fees contribute to total tax.
        *   The final `SELECT` statement in the SQL query was consistently truncated in many log entries for `Contact.php`, indicating that the log captured incomplete saves or partial changes.

3.  **Consistency in Model Structure:**
    *   The basic Laravel Model structure in `Contact.php` (connection, table, primary key, fillable fields, relationships) remains unchanged throughout the log.

4.  **Date-Based Data Filtering:**
    *   The `getDataWithDateRange` method in `Contact.php` is fundamentally designed to retrieve data based on a date range, with an additional `contractStatusFilter` for production. Despite temporary hardcoded filters, the core functionality revolves around this date range.

5.  **HubSpot Integration Logic:**
    *   `PlotBoxHubSpotService.php` consistently defines the logic for syncing contacts, deals, and associations with locations to HubSpot. The `processContacts` method is a central, robust function with individual try-catch blocks for different processing steps, highlighting a focus on fault tolerance.

In summary, the changes point to active development and debugging efforts, primarily focused on refining the data retrieval SQL query in the `Contact` model and intermittently debugging the HubSpot synchronization service. The SQL query underwent several micro-adjustments and temporary modifications before being fully defined.

## 12:04:28 PM
The changes primarily affect two files: `c:\Users\efeno\dev\datalink\app\Models\PlotBox\Contact.php` and `c:\Users\efeno\dev\datalink\app\SMCore\Services\PlotBox\PlotBoxHubSpotService.php`.

**File-specific updates:**

*   **`c:\Users\efeno\dev\datalink\app\Models\PlotBox\Contact.php` (Multiple timestamps between 1/21/2026, 12:51:05 PM and 1/22/2026, 2:29:50 PM):**
    *   **Initial Change (1/21/2026, 12:51:05 PM):** The `getDataWithDateRange` static method's SQL query in the `base_contracts` CTE initially filters by `LAST_UPDATED_DATE_TIME_UTC` or `dc.LAST_UPDATED_DATETIME` within the given `fromDate` and `toDate` range.
    *   **Introduction of Hardcoded Contract Number (1/21/2026, 12:52:00 PM):** A significant change occurred where the `WHERE` clause within the `base_contracts` CTE was modified to `WHERE DIM_CONTRACT.CONTRACT_NUMBER = '645-110814'`, effectively commenting out the original date range and `EXISTS` subquery conditions. This hardcoded filter limits the data retrieved to a specific contract.
    *   **Consistency in `COALESCE` Default (1/21/2026, 12:54:01 PM):** The `COALESCE` function for `Purchase_Price` in the final `SELECT` statement was updated, changing `COALESCE(cnp.net_price, pc.TOTAL_CASH_PRICE, 0)` to `COALESCE(cnp.net_price, 0)`. This implies `pc.TOTAL_CASH_PRICE` is no longer considered a fallback for `net_price` here, or it was deemed redundant.
    *   **Commented out `cancelled_contract_fee_tax` CTE (1/21/2026, 3:57:10 PM):** The entire `cancelled_contract_fee_tax` Common Table Expression (CTE) was commented out. Consequently, its inclusion in the `contract_tax_totals` CTE was also commented out (`// LEFT JOIN cancelled_contract_fee_tax ccft ON bc.CONTRACT_ID = ccft.CONTRACT_ID`).
    *   **Incorrect Column Reference in `SUM` (1/21/2026, 4:05:53 PM):** In the `contract_fee_tax` CTE, the `SUM` function was changed from `SUM(f.TAX_AMOUNT * cf.QUANTITY)` to `SUM(cf.TAX_AMOUNT * cf.QUANTITY)`. A similar change from `SUM(f.TAX_AMOUNT * df.QUANTITY)` to `SUM(cf.TAX_AMOUNT * df.QUANTITY)` also occurred in `deed_fee_tax`. This looks like a potential bug or an accidental change, as `cf.TAX_AMOUNT` and `df.TAX_AMOUNT` might not be correct references for the tax amount in those contexts (it should likely be `f.TAX_AMOUNT`).
    *   **Correction of Column Reference (1/21/2026, 4:16:07 PM):** The incorrect `cf.TAX_AMOUNT` and `df.TAX_AMOUNT` references in the `contract_fee_tax` and `deed_fee_tax` CTEs were corrected back to `f.TAX_AMOUNT`. Also, the `LOWER(f.FEE_TYPE) != 'interest'` was changed to `LOWER(f.FEE_TYPE) != 'Interest'` (capital 'I').
    *   **Attempted Type Casting and Contract Number Adjustment (1/21/2026, 4:20:08 PM - 1/21/2026, 4:20:28 PM):** In `contract_fee_tax`, `deed_fee_tax`, and `cancelled_contract_fee_tax` CTEs, the `WHERE cf.CONTRACT_ID IN (SELECT CONTRACT_ID FROM base_contracts)` was modified to `WHERE cf.CONTRACT_ID IN (CAST(SELECT CONTRACT_ID FROM base_contracts AS INT))`. The hardcoded `CONTRACT_NUMBER` in `base_contracts` also changed from `'645-110814'` to `'110814'`. These `CAST` operations were syntactically incorrect.
    *   **Reversion of Type Casting (1/21/2026, 4:23:56 PM):** The erroneous `CAST` operations (`CAST(SELECT CONTRACT_ID FROM base_contracts AS INT)`) were reverted to `(SELECT CONTRACT_ID FROM base_contracts)` in the fee tax CTEs.
    *   **Further Simplification of `contract_tax_totals` (1/21/2026, 4:27:14 PM - 1/21/2026, 4:31:12 PM):** The `COALESCE(ccft.cancelled_fee_tax_total, 0)` part within the `total_tax` calculation in `contract_tax_totals` was commented out entirely, making `total_tax` rely only on `contract_fee_tax_total` and `deed_fee_tax_total`.
    *   **Re-enabling Date Range Filter (1/21/2026, 4:31:12 PM):** The hardcoded `DIM_CONTRACT.CONTRACT_NUMBER = '110814'` filter in the `base_contracts` CTE was commented out, and the original date range filter (`(CAST(DIM_CONTRACT.LAST_UPDATED_DATE_TIME_UTC AS DATE) BETWEEN '{$fromDate}' AND '{$toDate}' OR EXISTS (...)`) was re-enabled. This effectively restored the date-based filtering mechanism.
    *   **Final SQL Query (1/22/2026, 11:24:20 AM):** The SQL query appears to be finalized, with the `cancelled_contract_fee_tax` CTE completely removed (not just commented out) and its reference removed from `contract_tax_totals`. The original date range filtering logic is in place.

*   **`c:\Users\efeno\dev\datalink\app\SMCore\Services\PlotBox\PlotBoxHubSpotService.php` (Multiple timestamps between 1/21/2026, 12:54:56 PM and 1/22/2026, 11:25:42 AM):**
    *   **Debugging `dd()` Statement (1/21/2026, 12:54:56 PM):** A `dd($dealsBatch);` statement was temporarily added after populating the batch arrays, likely for debugging purposes, causing the script to dump and die at that point.
    *   **Removal of `dd()` Statement (1/22/2026, 11:19:31 AM):** The `dd($dealsBatch);` debugging statement was removed, allowing the sync process to proceed beyond data mapping.
    *   **Re-introduction of `dd()` Statement (1/22/2026, 11:24:34 AM):** The `dd($dealsBatch);` debugging statement was re-introduced.
    *   **Final Removal of `dd()` Statement (1/22/2026, 11:25:42 AM):** The `dd($dealsBatch);` debugging statement was removed again.

**Timestamps of significant changes:**

*   **1/21/2026, 12:52:00 PM:** Hardcoding of a specific contract number for filtering in `Contact.php`.
*   **1/21/2026, 12:54:56 PM:** Addition of `dd($dealsBatch);` for debugging in `PlotBoxHubSpotService.php`.
*   **1/21/2026, 3:57:10 PM:** Commenting out `cancelled_contract_fee_tax` CTE and its reference in `Contact.php`.
*   **1/21/2026, 4:05:53 PM:** Introduction of incorrect column references in `SUM` functions in `Contact.php`.
*   **1/21/2026, 4:16:07 PM:** Correction of column references in `SUM` functions in `Contact.php`.
*   **1/21/2026, 4:20:08 PM:** Attempted, incorrect `CAST` operations and contract number modification in `Contact.php`.
*   **1/21/2026, 4:31:12 PM:** Re-enabling the original date range filter in `Contact.php`.
*   **1/22/2026, 11:19:31 AM:** Removal of `dd()` debugging in `PlotBoxHubSpotService.php`.
*   **1/22/2026, 11:24:20 AM:** Final removal of `cancelled_contract_fee_tax` CTE in `Contact.php`.
*   **1/22/2026, 11:24:34 AM & 11:25:42 AM:** Toggling of `dd()` debugging in `PlotBoxHubSpotService.php`.

**Patterns or recurring elements:**

*   **Debugging Cycles:** The `PlotBoxHubSpotService.php` file shows a clear pattern of adding and removing `dd($dealsBatch);` statements, indicating an iterative debugging process, likely for inspecting the `$dealsBatch` variable.
*   **SQL Query Refinement:** The `Contact.php` file demonstrates extensive iterative refinement of a complex SQL query within the `getDataWithDateRange` method. This includes:
    *   **Filtering adjustments:** Toggling between date-range filtering and hardcoded contract ID filtering, suggesting testing specific data points or development modes.
    *   **CTE modifications:** Commenting out and eventually removing a CTE (`cancelled_contract_fee_tax`), implying changes in data requirements or an optimization effort.
    *   **Syntax corrections:** Fixing incorrect column references and erroneous `CAST` operations, indicative of active development and testing of the SQL query logic.
*   **Focus on Tax Calculations and Item Counts:** The SQL query consistently includes multiple CTEs dedicated to calculating `total_cash_price`, `contract_fee_tax_total`, `deed_fee_tax_total`, and various `item_counts` (e.g., caskets, cremation products, markers), indicating a strong focus on detailed financial and inventory reporting for contracts.
*   **Primary and Deceased Contacts:** The query consistently selects data for both "primary contacts" and "deceased contacts" associated with contracts, suggesting a system that handles both active and historical/deceased individuals related to contracts.
*   **Standard Laravel Model Structure:** Both files adhere to standard Laravel conventions, using Eloquent models (`Contact.php`) and services (`PlotBoxHubSpotService.php`) for data interaction and business logic.

## 2:04:24 PM
The changes predominantly affect the `Contact.php` model file and, to a lesser extent, the `PlotBoxHubSpotService.php` service file. All changes occurred on `1/21/2026` and `1/22/2026`.

**File: c:\Users\efeno\dev\datalink\app\Models\PlotBox\Contact.php**

*   **1/21/2026, 12:51:05 PM**: This is the initial or a baseline version of the `Contact` Eloquent model. It defines a `getDataWithDateRange` static method that executes a complex Snowflake SQL query. This query retrieves detailed contract and contact information, including primary and deceased contacts, contract writers, item counts (categorized by type like caskets, cremation products, ground, markers, etc.), and calculates net prices and tax totals by joining multiple `DIM_*` tables. The query initially filters by `LAST_UPDATED_DATE_TIME_UTC` or `LAST_UPDATED_DATETIME` within a specified date range, and optionally by `DIM_CONTRACT.STATUS = 'Approved'` in production.
*   **1/21/2026, 12:52:00 PM - 1/21/2026, 4:05:53 PM**: Multiple small, iterative changes were made to the SQL query within the `getDataWithDateRange` method.
    *   The primary date range filtering condition (`CAST(DIM_CONTRACT.LAST_UPDATED_DATE_TIME_UTC AS DATE) BETWEEN '{$fromDate}' AND '{$toDate}' OR EXISTS (...)`) was commented out and replaced with a hardcoded `WHERE DIM_CONTRACT.CONTRACT_NUMBER = '645-110814'`. This suggests a debugging or testing phase, focusing on a specific contract.
    *   The `contract_fee_tax` and `deed_fee_tax` CTEs (Common Table Expressions) were modified. Initially, `SUM(f.TAX_AMOUNT * cf.QUANTITY)` was used. This was changed to `SUM(cf.TAX_AMOUNT * cf.QUANTITY)` or `SUM(df.TAX_AMOUNT * df.QUANTITY)`, indicating a correction in the column being summed for tax calculation (from `f.TAX_AMOUNT` to `cf.TAX_AMOUNT` or `df.TAX_AMOUNT`).
    *   The `cancelled_contract_fee_tax` CTE was consistently commented out across these timestamps, and its contribution to `contract_tax_totals` was also commented out. This implies this specific tax calculation was temporarily disabled or removed.
*   **1/21/2026, 4:16:07 PM**: The `LOWER(f.FEE_TYPE) != 'interest'` condition was changed to `LOWER(f.FEE_TYPE) != 'Interest'` in `contract_fee_tax` CTE (capitalization change).
*   **1/21/2026, 4:20:08 PM**: Introduced `CAST(... AS INT)` around `SELECT CONTRACT_ID FROM base_contracts` in the `WHERE` clauses of `contract_fee_tax`, `deed_fee_tax`, and the commented `cancelled_contract_fee_tax` CTEs. This indicates an attempt to explicitly cast the subquery result to an integer type, possibly to resolve type mismatch issues in Snowflake. The hardcoded contract number filter changed from `'645-110814'` to `'110814'` in `base_contracts`.
*   **1/21/2026, 4:23:56 PM**: The `CAST(... AS INT)` was removed from `deed_fee_tax` where the subquery was enclosed in `(SELECT CONTRACT_ID FROM base_contracts AS INT)` which appears to be a syntax error in the log (likely missing parentheses for the cast).
*   **1/21/2026, 4:26:14 PM - 1/21/2026, 4:32:48 PM**: Further refinements to the SQL query.
    *   The `CAST(... AS INT)` was fully removed from all `WHERE ... IN` clauses within `contract_fee_tax`, `deed_fee_tax`, and the commented `cancelled_contract_fee_tax` CTEs.
    *   The `COALESCE(ccft.cancelled_fee_tax_total, 0)` part in `contract_tax_totals` remained commented out, and at one point, it was explicitly removed (`//+ // COALESCE(ccft.cancelled_fee_tax_total, 0) AS total_tax`).
    *   The hardcoded contract number filter (`DIM_CONTRACT.CONTRACT_NUMBER = '110814'`) was eventually commented out, restoring the original date range filtering logic based on `LAST_UPDATED_DATE_TIME_UTC` and `LAST_UPDATED_DATETIME` for both contracts and contract owners.
    *   The final `SELECT` statement in `getDataWithDateRange` was consistently cut off, implying the logs might be truncated, but the overall structure and joins (e.g., `LEFT JOIN item_counts ic`) are present in the last entry.

**File: c:\Users\efeno\dev\datalink\app\SMCore\Services\PlotBox\PlotBoxHubSpotService.php**

*   **1/21/2026, 12:54:56 PM**: This service is responsible for syncing PlotBox data to HubSpot. The `syncPlotBoxData` method fetches data, maps it to CRM entities (contacts, deceased contacts, deals), and then processes these batches for creation, updating, and associating them within HubSpot.
    *   A `dd($dealsBatch);` (dump and die) statement was introduced after populating the batches, effectively pausing execution for debugging purposes.
*   **1/22/2026, 11:19:31 AM**: The `dd($dealsBatch);` debugging line was removed. This indicates the debugging step for deal batch generation was completed, and the sync process was re-enabled to run fully.
*   **1/22/2026, 11:24:34 AM**: Re-introduction of `dd($dealsBatch);` at the same location, suggesting further debugging or re-verification was needed for the deal batch.
*   **1/22/2026, 11:25:42 AM**: The `dd($dealsBatch);` line was again removed, indicating the debugging session for deals batching was finalized.

**Patterns and Recurring Elements:**

*   **Iterative Debugging in `Contact.php`**: There's a clear pattern of repeatedly modifying the SQL query within `Contact.php`, particularly toggling between a date range filter and a hardcoded `CONTRACT_NUMBER` for testing a specific case. The commenting/uncommenting of the `cancelled_contract_fee_tax` CTE also points to a focus on refining tax calculations.
*   **SQL `COALESCE` and `SUM`**: The SQL queries consistently use `COALESCE` to handle `NULL` values and `SUM` for aggregation, common practices in data warehousing queries for robustness.
*   **Snowflake Connection**: Both files reference 'snowflake' as the database connection, indicating a specific database environment.
*   **HubSpot Integration Logic**: The `PlotBoxHubSpotService` consistently follows a pattern of fetching data, mapping it, and then performing search, create, update, and association operations for contacts and deals in HubSpot, using `try-catch` blocks for resilience.
*   **Debugging with `dd()`**: The `dd($dealsBatch);` line appearing and disappearing in `PlotBoxHubSpotService.php` is a strong indicator of active debugging during development.
*   **Truncated Code Logs**: Several entries for `Contact.php` show truncated code at the end of the file, suggesting the log captured only a partial view of the file content at those timestamps.