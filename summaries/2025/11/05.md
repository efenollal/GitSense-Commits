# Activity Summary for 11/5/2025

## 1:41:30 PM
The provided log details changes to two PHP files, both Laravel Eloquent models, within the `App\Models\PlotBox` namespace.

**File-Specific Updates and Timestamps:**

*   **`c:\Users\efeno\dev\datalink\app\Models\PlotBox\Sale.php`** (Timestamp: `11/5/2025, 1:27:39 PM`):
    This file defines the `Sale` model. It's configured to connect to the `fabric` database, using the `DIM_CONTACT` table with `CONTACT_KEY` as its primary key. It includes two static methods:
    *   `getDataWithDateRange(string $fromDate, string $toDate)`: This method executes a large SQL query to retrieve contract and associated contact information. It fetches details for both primary (non-deceased) contacts and the first deceased contact linked to a contract. Data is filtered by the `LAST_UPDATED_DATE_TIME_UTC` column within the specified date range and ordered by `CONTRACT_KEY`. The query involves joins between `DIM_CONTRACT`, `DIM_CONTRACT_OWNER`, and `DIM_CONTACT` tables from the `WAREHOUSE_EVERSTORYPARTNERS` schema.
    *   `getHmisData()`: A convenience method that calls `getDataWithDateRange` for the current date, effectively fetching data updated today.

*   **`c:\Users\efeno\dev\datalink\app\Models\PlotBox\Contact.php`** (Timestamp: `11/5/2025, 1:30:12 PM`):
    This file defines the `Contact` model. Like the `Sale` model, it connects to the `fabric` database, using `DIM_CONTACT` and `CONTACT_KEY`. Crucially, the code content, including the `getDataWithDateRange` and `getHmisData` methods, is **identical** to that found in the `Sale.php` file.

**Patterns and Recurring Elements:**

The most significant pattern is the **exact duplication of the entire data retrieval logic** (both the complex SQL query within `getDataWithDateRange` and the `getHmisData` helper method) across both the `Sale` and `Contact` models. Both models share the same database connection (`fabric`), table (`DIM_CONTACT`), and primary key (`CONTACT_KEY`).

The SQL query itself consistently:
*   Uses Common Table Expressions (CTEs) named `base_contracts`, `primary_contacts`, and `deceased_contacts` to structure the data retrieval.
*   Filters contracts based on a date range applied to `LAST_UPDATED_DATE_TIME_UTC`.
*   Joins `DIM_CONTRACT`, `DIM_CONTRACT_OWNER`, and `DIM_CONTACT` tables.
*   Distinguishes between primary (non-deceased) contacts (`IS_DECEASED = 0`) and deceased contacts (`IS_DECEASED = 1`), using `ROW_NUMBER()` to select a single primary and a single deceased contact per contract.
*   Selects a comprehensive set of contact and contract-related fields, aliasing them with clear, descriptive names (e.g., `Primary_First_Name`, `Deceased_Last_Name`, `Sales_Contract_Nbr`, `Purchase_Price`).
*   The timestamps indicate these changes occurred very close to each other, suggesting they might be part of the same development task or commit where this duplicated logic was introduced.