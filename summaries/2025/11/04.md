# Activity Summary for 11/4/2025

## 3:17:04 PM
The file `c:\Users\efeno\dev\datalink\app\Models\PlotBox\Sale.php` is a Laravel Model responsible for interacting with sales data from a PlotBox system. It uses an `sqlsrv_plotbox` connection for the model itself, but its primary data retrieval method, `getDataWithDateRange`, queries a separate `fabric` database connection.

At **11/4/2025, 3:11:30 PM**, the `Sale` model contained a `getDataWithDateRange` static method that executed a complex SQL query. This query joined `DIM_CONTRACT`, `DIM_CONTRACT_OWNER`, and `DIM_CONTACT` tables from `WAREHOUSE_EVERSTORYPARTNERS` to fetch various details including contact information, contract specifics (number, purchase date, price), and details for a deceased contact associated with the contract. The query filtered records based on a `LAST_UPDATED_DATE_TIME_UTC` range. A `getHmisData` method was also present, leveraging `getDataWithDateRange` to retrieve data for the current day.

A subsequent update at **11/4/2025, 3:12:55 PM** introduced several refinements to the SQL query within `getDataWithDateRange`. The `SELECT` statement was modified to include `DISTINCT`, ensuring unique rows. More specific filtering was added to the `INNER JOIN` for the primary `DIM_CONTACT`, explicitly setting `DIM_CONTACT.IS_DECEASED = 0` to retrieve only living contacts as primary. Additionally, the `LEFT JOIN` for `DECEASED_CONTACT` was enhanced to explicitly ensure `DECEASED_CONTACT.IS_DECEASED = 1` and, critically, to include `DECEASED_CONTACT.CONTACT_KEY != DIM_CONTACT.CONTACT_KEY`. This last condition prevents the deceased contact from being the same as the primary living contact, improving data accuracy. It's also notable that this update introduced a syntax error by duplicating the function signature `public static function getDataWithDateRange(string $fromDate, string $toDate)` within itself.

A recurring pattern in these changes is the focus on distinguishing between living and deceased contacts associated with sales contracts, along with consistent querying of a `WAREHOUSE_EVERSTORYPARTNERS` schema across multiple joined dimension tables. The queries also consistently use date range filtering on the `LAST_UPDATED_DATE_TIME_UTC` column.